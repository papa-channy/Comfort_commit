# Comfort_commit# Comfort Commit ì‹œìŠ¤í…œ ì„¤ê³„ì„œ  
## 1. í”„ë¡œì íŠ¸ ê°œìš” & ì² í•™ (WHY)

### 1â€‘1. ë°°ê²½ Â· ë¬¸ì œê°€ì¹˜
| ê¸°ì¡´ ê°œë°œ í˜„ì‹¤ | Pain Point (ì •ëŸ‰ ê·¼ê±°) |
| -------------- | ---------------------- |
| **ì»¨í…ìŠ¤íŠ¸ ì†ì‹¤** â€” uuidEë¥¼ ë‹«ëŠ” ìˆœê°„ â€œë¬´ì—‡ì„ ì™œ ë°”ê¿¨ëŠ”ê°€â€ê°€ ë¨¸ë¦¿ì†ì—ì„œ ë¹ ë¥´ê²Œ ì‚¬ë¼ì§ | í‰ê·  3â€¯ì‹œê°„ ë’¤ ì»¤ë°‹ ì‘ì„± ì‹œ ë³€ê²½ ë§¥ë½ íšŒìƒë¥  **<â€¯35â€¯%** |
| **ë‚®ì€ ì»¤ë°‹ í’ˆì§ˆ** â€” `fix bug`, `update` ë¥˜ ë©”ì‹œì§€ ë‹¤ë°œ | ì½”ë“œ ë¦¬ë·° â€œì˜ë„ íŒŒì•… ì‹œê°„â€ì´ ì „ì²´ ë¦¬ë·° ì‹œê°„ì˜ **41â€¯%** |
| **ë¦¬ë·° ê³¼ë¶€í•˜** â€” íŒŒì¼Â·í•¨ìˆ˜ ìŠ¤ì½”í”„ ë’¤ì„ì—¬ PR ê²€í†  í´ë¦­ìˆ˜ í­ì¦ | SaaS ë¦¬í¬ 1â€¯PRë‹¹ í‰ê·  **211â€¯ì´ˆ** ì†Œëª¨ |
| **ì¥ì†Œ ì œì•½** â€” ì»¤ë°‹ ìŠ¹ì¸ì€ â€œì‚¬ë¬´ì‹¤ PC ì•â€ì— ë¬¶ì—¬ ìˆìŒ | í†µê·¼Â·ì´ë™ ì‹œê°„ **0â€¯%** í™œìš© |

### 1â€‘2. Comfort Commit ë¹„ì „
> **â€œì½”ë“œ ë³€ê²½ì´ ëë‚˜ëŠ” ìˆœê°„, ë‹¹ì‹ ì˜ â€˜ì¼ìƒâ€™ ì†ì—ì„œ ì»¤ë°‹ì´ ì™„ê²°ëœë‹¤.â€**

| í•µì‹¬ ê°€ì¹˜ | êµ¬í˜„ ë°©ì‹ | ê¸°ëŒ€ íš¨ê³¼ |
| --------- | -------- | --------- |
| **ì¼ìƒ ëª°ì…â€¯(Seamless Lifeâ€‘flow)** | uuidE ì¢…ë£Œ í›… ê°ì§€ â†’ 5â€¯ì´ˆ ë‚´ ëª¨ë°”ì¼â€¯Push ë§í¬ ë°œì†¡ â†’ ì‚¬ìš©ìëŠ” ì´ë™ ì¤‘Â·í‡´ê·¼ ê¸¸ì—ë„ ë¸Œë¼ìš°ì € í•œ í™”ë©´ì—ì„œ ì´ˆì•ˆ ìˆ˜ì •Â·ìŠ¹ì¸ | ì‚¬ë¬´ì‹¤ ë³µê·€Â ì—†ì´ ì»¤ë°‹ ì™„ë£Œ â†’ ì—…ë¬´ ë°€ë„Â â†‘, í‡´ê·¼ ì§€ì—°Â â†“ |
| **ë§¥ë½ ë³´ì¡´â€¯(Context Memory)** | AIê°€ ë³€ê²½ ë²”ìœ„(íŒŒì¼Â·í•¨ìˆ˜Â·ì‹¬ë³¼) ê·¸ë˜í”„í™” â†’ ìš”ì•½ + ì´ˆì•ˆ ë©”ì‹œì§€ ì¦‰ì‹œ ì œì‹œ | â€œë°”ê¾¼ ì§í›„â€ ê²€í† ë¡œ ê¸°ì–µ ì •ì°© íš¨ê³¼, ì§€ì‹ ìì‚° ì¥ê¸° ë³´ì¡´ |
| **ë³´ì•ˆ ìš°ì„ â€¯(Security by Design)** | TLSÂ ì „êµ¬ê°„ Â· AESâ€‘256, ì„ë² ë”©Â·ë¡œê·¸ ì‚¬ë‚´Â DB í•œì • | IP ìœ ì¶œ **0â€¯%** ì›ì¹™ ì¤€ìˆ˜ |
| **ì¬ì‚¬ìš© ì§€ëŠ¥â€¯(Reâ€‘use Intelligence)** | ì‚¬ìš©ì ìˆ˜ì •ë³¸â€‘ì„ë² ë”© ìºì‹œ â†’ ìœ ì‚¬ë„â€¯â‰¥â€¯0.85ë©´ LLM í˜¸ì¶œÂ Skip | ì¸í¼ëŸ°ìŠ¤ ë¹„ìš©Â â†“â€¯20â€¯%, ì§€ì—°Â â†“â€¯35â€¯% |

#### ì‚¬ìš© íë¦„ ì˜ˆì‹œ
ì½”ë“œ ìˆ˜ì • â†’ uuidE ì €ì¥ â†’ VSÂ Code ì¢…ë£Œ

2â€¯ì´ˆ ë’¤ SlackÂ DM â€œğŸ“ ì»¤ë°‹ ì´ˆì•ˆ ê²€í† â€ ë„ì°©

ì§€í•˜ì²  ì•ˆì—ì„œ ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ì—´ê¸°
â”Œ ë³€ê²½ ìš”ì•½ ì¹´ë“œÂ â”‚ AI ì´ˆì•ˆ â”‚ diff â”‚ ìˆ˜ì •Â·ìŠ¹ì¸ â”

30â€¯ì´ˆ ë‚´ ìŠ¹ì¸ â†’ ìë™ commitÂ & push

ë¡œê·¸ = Loki, ìµœì¢… ë©”ì‹œì§€Â·ë²¡í„° = PostgreSQLÂ·OpenSearch

---

## 2. ì•„í‚¤í…ì²˜ ì„¤ê³„ ì›ì¹™ (HOW)

| # | ì›ì¹™ | ê¸°ìˆ  ì ìš© Â· ìš´ì˜ ê·œì¹™ |
|---|------|----------------------|
| **Pâ€‘1Â ë¶ˆë³€ ì½”ì–´** | Docker Â· Pythonâ€¯3.13 Â· PostgreSQLâ€¯16 Â· pgvector Â· FastAPI Â· JSONL ì€ ì˜êµ¬ ë¶ˆë³€<br>Elastic LayerëŠ” ë¶™ì˜€ë‹¤Â ë–¼ê¸° | ì½”ë“œ ì´ë™/ìŠ¤ì¼€ì¼ ì´ë™ ì‹œ ë¦¬ìŠ¤í¬ ìµœì†Œí™” |
| **Pâ€‘2Â Seamless Lifeâ€‘flow** | HookÂ â†’ Mobile PushÂ â†’ Auto Commit 1â€¯ë¶„ ë‚´ ì™„ê²° | ì‚¬ìš©ìëŠ” â€œì½”ë“œ í¸ì§‘ â†” ìŠ¹ì¸â€ ì™¸ ì‘ì—…Â 0 |
| **Pâ€‘3Â Security First** | OAuthâ€¯â†’ JWTâ€¯â†’ AESâ€‘256 Refresh ì €ì¥, RBACâ€¯(action) í†µì œ | ëª¨ë“  ë¯¼ê° ë°ì´í„°ëŠ” ê²½ê³„ ë‚´ & ì•”í˜¸í™” |
| **Pâ€‘4Â Observability by Default** | `trace_uuid`, `repo_uuid`, `user_uuid` ë¼ë²¨ì„ ì‹œì‘ë¶€í„° ë¶€ì—¬ â†’ Loki Â· Prometheus Â· OpenSearch ìë™ ì—°ê²° | MTTR <â€¯5â€¯ë¶„ |
| **Pâ€‘5Â Scaleâ€‘Out First** | APIÂ stateless, Celery/Redis/LLMÂ Pool ë…¸ë“œëŠ” ì½”ë“œ ìˆ˜ì •Â ì—†ì´ ì¦ì„¤ | ê¸€ë¡œë²Œ ì ì‹¬Â·í‡´ê·¼ ìŠ¤íŒŒì´í¬ ëŒ€ì‘ |
| **Pâ€‘6Â Reâ€‘use Intelligence** | ì„ë² ë”© ìºì‹œ ìœ ì‚¬ë„Â 0.85â†‘ hitÂ â†’Â LLM í˜¸ì¶œ Skip | í´ë¼ìš°ë“œ ë¹„ìš©, ì§€ì—° ë™ì‹œ ì ˆê° |
| **Pâ€‘7Â Configâ€‘asâ€‘Runtime** | `plan_config.yml`Â ë“± ì •ì±… íŒŒì¼ì„ í•«Â ë¦¬ë¡œë“œ | ìš”ê¸ˆì œÂ·ì •ì±… ë³€ê²½ ì¦‰ì‹œ ë¬´ì¤‘ë‹¨ ë°˜ì˜ |

### ì›ì¹™ ì²´ê° ì˜ˆì‹œ

| ì‹œë‚˜ë¦¬ì˜¤ | ì›ì¹™ ì ìš© | ê²°ê³¼ |
|----------|----------|------|
| **ê¸€ë¡œë²Œ íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬** | Pâ€‘5Â HPA 10â†’60Â replica | ì‘ë‹µÂ P95Â <Â 3.8â€¯s ìœ ì§€ |
| **ë³´ì•ˆ ê°ì‚¬ ìš”êµ¬** | Pâ€‘3 Â·Â Pâ€‘4Â action ë¡œê·¸ + trace_uuid | 30â€¯ì´ˆ ë‚´ ì›ì¸ ì¶”ì  |
| **ìš”ê¸ˆì œ ì •ì±… ë³€ê²½** | Pâ€‘7Â configÂ í•« ë¦¬ë¡œë“œ | ì¬ë°°í¬ ì—†ì´ ì¦‰ì‹œ ë°˜ì˜ |
| **ë°˜ë³µ ì»¤ë°‹** | Pâ€‘6Â ì„ë² ë”© ì¬ì‚¬ìš© | LLMÂ ë¹„ìš©Â â†“â€¯20â€¯%, ì§€ì—°Â â†“â€¯35â€¯% |

---

## 3. í•µì‹¬ ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†ŒÂ â€”Â FixedÂ Kernel

| ê³„ì¸µ | ê¸°ìˆ Â &Â ë²„ì „ | ì•„í‚¤í…ì²˜ í¬ì¸íŠ¸ | ë³´ì•ˆÂ·ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ |
|------|-------------|-----------------|----------------------|
| **ì»¨í…Œì´ë„ˆ** | **DockerÂ 25**Â +Â dockerâ€‘composeâ€¯v2 <br>(â†’Â Helm/Kustomize ë³€í™˜) | ì´ë¯¸ì§€ë§ˆë‹¤ **SBOMÂ +Â CosignÂ ì„œëª…**<br>ë©€í‹°Â ì•„í‚¤í…ì²˜(amd64/arm64) ë¹Œë“œ | `read_only: true`, `rootless`, `seccomp=default` |
| **ëŸ°íƒ€ì„** | **PythonÂ 3.13**Â +Â Poetry.lock | tomllibÂ ë‚´ì¥, UTFâ€‘8Â default | `PYTHONHASHSEED=0`Â ê³ ì •, `uvloop`Â ì˜µì…˜ |
| **WebÂ API** | **FastAPIÂ 1.4**Â + Uvicorn workers | StarletteÂ ASGIÂ = trueÂ async I/O<br>OpenAPIÂ â†’ ë‚´ë¶€Â SDK(py/js)Â ìƒì„± | ëª¨ë“ Â ì‘ë‹µÂ í—¤ë”ì—Â `trace_uuid`,Â `repo_uuid` |
| **RDBMS** | **PostgreSQLÂ 16** | JSONBÂ +Â Rowâ€‘LevelÂ Security, FTSÂ GIST | pgbouncerÂ pool, TLSÂ inâ€‘transit |
| **ë²¡í„°** | **pgvectorÂ 0.8Â (HNSW)**<br>Freeâ†’code2vecâ€¯512dim<br>Orgâ†’BERTâ€¯1536dim | HNSWÂ M=16,Â ef_construction=200 | ë°°ì¹˜Â `REINDEXÂ VECTOR`Â í¬ë¡  |
| **ë¡œê¹… í¬ë§·** | **JSONL**Â (6Â ë¼ë²¨Â *svc,lvl,ts,id,repo,trace*) | tailâ€‘f, S3Â ì—…ë¡œë“œ, LokiÂ í˜¸í™˜ | ë¯¼ê°Â ì •ë³´ RegExpÂ í•„í„° |
| **ì‹œìŠ¤í…œ ë¡œê·¸** | **LokiÂ 3.0**Â +Â S3Â objâ€‘store | ë¼ë²¨Â ì¸ë±ì‹±Â ì €ë¹„ìš©, GrafanaÂ alert | errorìœ¨Â >1â€¯%Â â†’Â SlackÂ #infra |
| **ì½˜í…ì¸  ë¡œê·¸** | **OpenSearchÂ 3.0**Â +Â pgvector | planÂ prefixÂ ìƒ‰ì¸, BM25Â +Â HNSW | indexâ€‘levelÂ IAM |
| **í† í° ëª¨ë‹ˆí„°** | **@track_tokens**Â (tiktoken) | 30â€¯ÂµsÂ ì˜¤ë²„í—¤ë“œ, ë¹„ìš©Â·latencyÂ ë¡œê·¸ | AccessKeyÂ ê·¸ë£¹ë³„Â costÂ view |
| **íŒ¨í‚¤ì§€ ë ˆì´ì–´** | `api/Â services/Â models/Â schemas/` | routerâ†’serviceâ†’ORMÂ 3â€‘hopÂ DI | pytestÂ fixtureÂ mockÂ DB |

---

## 4. ìœ ì—° í™•ì¥ ê³„ì¸µÂ â€”Â ElasticÂ Layer

| ì¹´í…Œê³ ë¦¬ | Phaseâ€¯0 (â‰¤1â€¯kÂ DAU) | Phaseâ€¯1 (~30â€¯k) | Phaseâ€¯2 (30â€¯kâ€“300â€¯k) | **ìŠ¤ì¼€ì¼ íŠ¸ë¦¬ê±°** |
|----------|-------------------|-----------------|----------------------|-------------------|
| APIÂ Replica | GunicornÃ—3 | GunicornÃ—10 | K8sÂ HPAâ†’60Â pod | CPU>65â€¯% Â·Â RPS>500 |
| LLMÂ Inference | OpenAIÂ singleâ€‘key | vLLMÂ (g5.xlarge)Ã—2 | SpotÂ A10GÂ PoolÂ AutoScale | í•¨ìˆ˜â€¯QPSâ‰¥100 |
| ì•Œë¦¼ í | BackgroundTask | Celery+Redis | RedisÂ 3â€‘Shard | backlog>1â€¯k |
| RedisÂ Cache | RedisÂ single | RedisÂ Sentinel | MemoryDBÂ Cluster | RT>20â€¯ms |
| ìƒ‰ì¸Â ëª¨ë¸ | code2vec | code2vec+BERTÂ í•„ë“œ | planÂ prefixÂ ë¶„ë¦¬ | plan=org |
| CDN | â€“ | CloudFrontÂ +Â R2 | EdgeÂ KVÂ POP | EdgeÂ errorìœ¨>2â€¯% |
| ë¡œê·¸ ë³´ì¡´ | LokiÂ 7d | 30d+Glacier | 90d+S3Â IA | Storage>1TB |
| ìš”ê¸ˆì œÂ Hotâ€‘Reload | plan_configÂ YAML | AdminÂ UIâ†’RedisÂ pub | ConsulÂ watch | ì •ì±…Â commit |

---

## 5. ì¸ì¦Â & ê¶Œí•œ ëª¨ë¸Â â€”Â OAuthÂ +Â RBAC(Action)

### 5â€‘1. ì¸ì¦ í”Œë¡œìš°
1. **OAuthÂ 2.0**Â (google) â†’ auth_code
2. `user_info`Â UPSERTÂ â†’ `id`
3. **JWT**Â (AccessÂ 10â€¯minÂ / RefreshÂ 30â€¯day)
4. RefreshÂ í† í°Â AESâ€‘256â€‘GCMÂ ì•”í˜¸í™” â†’ `user_secret`
5. `/refresh`Â â†’Â AccessÂ ê°±ì‹ , RefreshÂ Rotation

### 5â€‘2. RBACâ€¯ìŠ¤í‚¤ë§ˆ
```sql
role(role_uuid, name)
action(action_uuid, code)
role_action_map(role_uuid, action_uuid)
user_info(id, email, role_uuid)
```

### 5â€‘3. ê¶Œí•œ ê²€ì‚¬ ìœ í‹¸
```python
def require(action):
    def deco(fn):
        async def wrap(user, *a, **kw):
            if action not in user.permissions:
               raise HTTPException(403)
            return await fn(user,*a,**kw)
        return wrap
    return deco
```

### 5â€‘4. ê°ì‚¬ ë¡œê·¸ & ëª¨ë°”ì¼ ë³´ì•ˆ
| ìœ„í˜‘ | ë°©ì–´ |
|------|------|
| ë§í¬ íƒˆì·¨ | JWT TTLÂ 10min +Â URIÂ nonce |
| ê¸°ê¸° ë¶„ì‹¤ | RefreshÂ Rotation + revoke API |
| ì„¸ì…˜ ê³ ì • | SameSite=strictÂ ì¿ í‚¤ |


---

## 6. ì‚¬ìš©ì ìš”ê¸ˆì œÂ &Â ê¸°ëŠ¥ ë¶„ê¸°
### 6â€‘1Â |Â `plan_catalog`Â ë§ˆìŠ¤í„° í…Œì´ë¸”Â +Â ì‹œë”©
```sql
-- â¶ ìš”ê¸ˆì œ ì •ì˜ (once-only)
CREATE TABLE plan_catalog (
  plan_key               TEXT PRIMARY KEY,        -- 'free','basic','premium','org'
  plan_label             TEXT NOT NULL,           -- UI í‘œì‹œëª…
  monthly_price_usd      NUMERIC(6,2) NOT NULL,   -- $/ìœ ì €  (org=0 â†’ seat ë‹¨ê°€ê°€ ì•„ë‹Œ íŒ¨í‚¤ì§€ ê°€ê²©)
  max_commits_per_day    INT,
  max_commits_per_month  INT,
  max_describes_per_month INT,
  max_uploads_per_day    INT,
  kakao_noti_remaining   INT,
  slack_enabled          BOOLEAN,
  ad_layer_enabled       BOOLEAN,
  instant_commit_generation BOOLEAN,
  save_commit_message    BOOLEAN,
  save_describe_enabled  BOOLEAN,
  commit_report_enabled  BOOLEAN,
  visualization_report_enabled BOOLEAN,
  prompt_personalization_enabled BOOLEAN,
  data_retention_days    INT,
  team_features_enabled  BOOLEAN,
  trial_days             INT,
  plan_order             INT UNIQUE,              -- UI ë…¸ì¶œ ìˆœì„œ
  is_team_plan           BOOLEAN DEFAULT FALSE
);

INSERT INTO plan_catalog
(plan_key,plan_label,monthly_price_usd,max_commits_per_day,max_commits_per_month,
 max_describes_per_month,max_uploads_per_day,kakao_noti_remaining,slack_enabled,
 ad_layer_enabled,instant_commit_generation,save_commit_message,save_describe_enabled,
 commit_report_enabled,visualization_report_enabled,prompt_personalization_enabled,
 data_retention_days,team_features_enabled,trial_days,plan_order,is_team_plan)
VALUES
-- FREE â”€ ê°œì¸ ì²´í—˜
('free','Free',0,
 5,100,100,10,
 0,FALSE,
 TRUE,FALSE,TRUE,TRUE,
 FALSE,FALSE,FALSE,
 30,FALSE,0,1,FALSE),

-- BASIC â”€ ì†Œê·œëª¨ íŒ€/í”„ë¦¬ëœì„œ
('basic','Basic',9,
 100,2000,2000,200,
 20,TRUE,
 FALSE,TRUE,TRUE,TRUE,
 TRUE,FALSE,FALSE,
 180,FALSE,14,2,FALSE),

-- PREMIUM â”€ ì¢Œì„ ë‹¨ê°€ ìµœìƒìœ„ ê°œë³„ ìœ ì €
('premium','Premium',29,
 500,UNLIMITED,UNLIMITED,1000,
 200,TRUE,
 FALSE,TRUE,TRUE,TRUE,
 TRUE,TRUE,TRUE,
 365,FALSE,14,3,FALSE),

-- ORG â”€ ì—”í„°í”„ë¼ì´ì¦ˆ íŒ¨í‚¤ì§€ (ì¢Œì„ë‹¹ì´ ì•„ë‹ˆë¼ ì¡°ì§ ë¼ì´ì„ ìŠ¤)
('org','Enterprise',0,      -- seat price 0 â†’ ë³„ë„ ê³„ì•½
 UNLIMITED,UNLIMITED,UNLIMITED,UNLIMITED,
 1000,TRUE,
 FALSE,TRUE,TRUE,TRUE,
 TRUE,TRUE,TRUE,
 1825,TRUE,30,4,TRUE);
```

### 6â€‘2Â |Â `user_plan`Â +Â `user_plan_history`
- FK ì¶”ê°€
ALTER TABLE user_plan
  ADD CONSTRAINT fk_user_plan_plan
  FOREIGN KEY(plan_key) REFERENCES plan_catalog(plan_key);

-- ë³€ê²½ íŠ¸ë¦¬ê±°(ìš”ì•½)
CREATE OR REPLACE FUNCTION log_plan_change() RETURNS trigger AS $$
BEGIN
  IF NEW.plan_key <> OLD.plan_key THEN
    INSERT INTO user_plan_history(
      id, old_plan_key, new_plan_key,
      old_plan_label, new_plan_label,
      old_price_usd, new_price_usd,
      was_trial, effective_from
    )
    SELECT OLD.id,
           OLD.plan_key, NEW.plan_key,
           (SELECT plan_label FROM plan_catalog WHERE plan_key=OLD.plan_key),
           (SELECT plan_label FROM plan_catalog WHERE plan_key=NEW.plan_key),
           (SELECT monthly_price_usd FROM plan_catalog WHERE plan_key=OLD.plan_key),
           (SELECT monthly_price_usd FROM plan_catalog WHERE plan_key=NEW.plan_key),
           OLD.is_trial_active,
           now();
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_user_plan_change
BEFORE UPDATE ON user_plan
FOR EACH ROW EXECUTE FUNCTION log_plan_change();

### 6â€‘3Â |Â ëŸ°â€‘íƒ€ì„ ë¶„ê¸° ì˜ˆì‹œ
```python
@lru_cache
def load_plan_catalog():
    import yaml
    with open("config/plan_catalog.yml") as f:
        return yaml.safe_load(f)

def get_plan(user_uuid):
    row = db.fetchrow("SELECT plan_key FROM user_plan WHERE id=%s", user_uuid)
    return load_plan_catalog()[row['plan_key']]

def enforce_limit(user_uuid, feature, amount=1):
    plan = get_plan(user_uuid)
    limit = plan.get(feature)
    if limit and get_usage(user_uuid, feature)+amount > limit:
        raise HTTPException(429,f"{feature} ì´ˆê³¼")
```

---

## 7. ë¡œê·¸ ìˆ˜ì§‘Â &Â ë°ì´í„° ë¶„ë¦¬ ì „ëµ
| ë°ì´í„° íƒ€ì… | ì €ì¥ì†Œ | TTL | ëŒ€í‘œÂ Query |
|-------------|--------|-----|-----------|
| ì‹œìŠ¤í…œ ë¡œê·¸ | LokiÂ +Â S3 | 30â€¯d | `rate_errors{{svc="api"}}` |
| ë¹„ì¦ˆ ì´ë²¤íŠ¸ | PostgreSQLÂ `biz_event` | âˆ | ì›”ë³„ KPI |
| ì½˜í…ì¸  ë¡œê·¸ | OpenSearchÂ `cc_{{plan}}_commit_log_YYYYMM` | Freeâ€¯30â€¯d / Orgâ€¯âˆ | KNNÂ +â€¯BM25 |
| ì„ì‹œ ìºì‹œ | Redis | 1â€‘4â€¯h | diffÂ preview |

---

## 8. AI ì„ë² ë”©Â &Â ìœ ì‚¬ë„ ê²€ìƒ‰
| í”Œëœ | ëª¨ë¸ | ì°¨ì› | í•„ë“œ | ì¬ì‚¬ìš© ê¸°ì¤€ |
|------|------|------|------|-------------|
| Free/Basic | code2vec | 512 | `embedding_code2vec` | cosâ€¯â‰¥â€¯0.85 |
| Premium/Org | BERT / textâ€‘embeddingâ€‘3 | 1536 | `embedding_bert` | cosâ€¯â‰¥â€¯0.90 |

### 8â€‘1Â |Â ì„ë² ë”©Â íŒŒì´í”„ë¼ì¸
1. ì»¤ë°‹ ì´ˆì•ˆ â†’ LLM í˜¸ì¶œ  
2. í•¨ìˆ˜ Topâ€‘10 â†’ code2vec ì„ë² ë”© â†’ Topâ€‘3 í™•ì •  
3. pgvectorÂ KNNÂ ê²€ì‚¬ â†’ hitâ€¯â‰¥â€¯0.85 â‡’ LLMÂ Skip  
4. ìµœì¢… ë©”ì‹œì§€ í™•ì • â†’ OpenSearch ìƒ‰ì¸  
5. Premium/Org í”Œëœì€ BERT ì„ë² ë”© ì¶”ê°€ ìƒ‰ì¸

```python
field = "embedding_bert" if plan in {{ "premium","org" }} else "embedding_code2vec"
```

---

## 9. ì „ì²´ ì‹œìŠ¤í…œ ë°ì´í„° íë¦„ & ëª¨ë“ˆ ì—°ê²°

uuidE ì¢…ë£Œ ì´ë²¤íŠ¸ â”€â”€â–º FastAPI(api) â”€â”€â–º Preâ€‘process(prep/, scoping/)
â”‚ â”‚
â”‚ â””â”€â–º LLM Manager + @track_tokens
â”‚ â”‚
â”‚ â””â”€â–º Notification(slack/mobile)
â”‚ â”‚
â”‚ â–¼
â””â”€â–º Loki(JSONL) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ action_log â—„â”€ ëª¨ë°”ì¼ ìŠ¹ì¸
â”‚
â–¼
Autoâ€‘Commit(git add/commit/push)
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OpenSearch ìƒ‰ì¸(embedding) â—„â”€â”€ embedding_worker
â”‚
â””â”€ Grafana / OsDash / Prometheus â†â”€ trace_uuid ê¸°ë°˜ ì§‘ê³„

yaml
í•­ìƒ ì„¸ë¶€ ì •ë³´ í‘œì‹œ

ë³µì‚¬

* **trace_uuid** : APIÂ â†’Â LokiÂ â†’Â OpenSearchÂ ì—°ê²° í‚¤  
* **plan_key** : ìƒ‰ì¸ prefixÂ·ì„ë² ë”© í•„ë“œ ì„ íƒ  
* **action_log** : RBAC ê°ì‚¬, ëˆ„ê°€ ì–¸ì œ ë¬´ì—‡ì„ ìˆ˜ì •

---

## 10. MVP ê°œë°œ ìš°ì„ ìˆœìœ„ & ëŸ°â€‘ì—… ë¡œë“œë§µ

| ìŠ¤í”„ë¦°íŠ¸ | ì‚°ì¶œë¬¼ | ì œì™¸ ë²”ìœ„ |
|----------|--------|-----------|
| **Sâ€‘1Â (ì£¼â€¯1â€‘2)** | VSCodeÂ hookÂ·FastAPIÂ skeleton | ëª¨ë°”ì¼ UI |
| **Sâ€‘2Â (ì£¼â€¯3â€‘4)** | diffÂ â†’ conv_dfÂ â†’ clusteringÂ Topâ€‘3<br>LLMÂ managerÂ + track_tokens | íŒ€ í”ŒëœÂ·RBAC |
| **Sâ€‘3Â (ì£¼â€¯5â€‘6)** | code2vec ì„ë² ë”©Â PG ì €ì¥<br>SlackÂ DM ë§í¬<br>Free í”Œëœ catalog | BERT ëª¨ë¸ |
| **Sâ€‘4Â (ì£¼â€¯7â€‘8)** | ëª¨ë°”ì¼ ìŠ¹ì¸ RWDÂ í˜ì´ì§€<br>git autoâ€‘commit<br>LokiÂ + Grafana | CeleryÂ·K8sÂ HPA |
| **Sâ€‘5Â (ì£¼â€¯9)** | OAuthÂ Login, AESâ€‘refresh ì €ì¥<br>action_logÂ + require() | SSOÂ (SAML) |

* **MVP KPI** : ì²« ì»¤ë°‹ ì‘ì„±Â ì‹œê°„ **â‰¥â€¯60â€¯% ë‹¨ì¶•**, ì˜¤ë¥˜ ì¬ì‹œë„ **<â€¯1â€¯%**

---

## 11. ìš´ì˜Â·ë³´ì•ˆÂ·í™•ì¥ ì „ëµ

### 11â€‘1Â |Â SRE ê´€ì¸¡ ì§€í‘œ
| ì§€í‘œ | ì„ê³„ì¹˜ | ìë™ ì¡°ì¹˜ |
|------|--------|-----------|
| API P95 latency | 4â€¯s | K8sÂ HPAÂ scaleâ€‘out |
| LLM fail_rate | 3â€¯% | fallback_on_cache |
| Celery backlog | 1â€¯k | worker spawn |
| DB replica lag | 2â€¯s | ì½ê¸°Â redirect |

### 11â€‘2Â |Â ë³´ì•ˆ
* OAuthâ€‘only, ë¹„ë°€ë²ˆí˜¸ ë¯¸ë³´ê´€  
* Rowâ€‘LevelÂ Security (repo ACL)  
* Column AESâ€‘256 (refresh_token, ê²°ì œì •ë³´)  
* CSPÂ +Â HSTSÂ +Â SameSite=strict ì¿ í‚¤

### 11â€‘3Â |Â ë¹„ìš©Â·ìŠ¤ì¼€ì¼
| ë¦¬ì†ŒìŠ¤ | ì•Œë¦¼ | ëŒ€ì‘ |
|--------|------|------|
| LLM ë¹„ìš© | ì›” \$500 | key rotationÂ·fineâ€‘tune ìºì‹œ |
| OpenSearch | 80â€¯% storage | ILMÂ hotâ†’warmâ†’cold |
| GPU Pool | Spot ì¤‘ë‹¨ | disruptionÂ budgetÂ 30â€¯s |

---

## 12. ê²°ë¡  & í–¥í›„ í™•ì¥

| ë²„ì „ | ê¸°ëŠ¥ | ê°€ì¹˜ ì§€í‘œ |
|------|------|-----------|
| **v1.0 GA** | Free/BASICÂ +Â ëª¨ë°”ì¼ ìŠ¹ì¸ | ì»¤ë°‹ ì‘ì„± ì§€ì—°Â 60â€¯%â†“ |
| **v1.5** | PremiumÂ (BERT ì„ë² ë”©)Â +Â Prompt personal | ìœ ì‚¬ ì»¤ë°‹ ìë™ ì±„ì›€Â 25â€¯%â†‘ |
| **v2.0** | Org íŒ¨í‚¤ì§€Â +Â SSOÂ +Â ì „ë‹´ VPC | ë³´ì•ˆÂ·ê·œì œ ì‹œì¥ ì¹¨íˆ¬ |
| **v2.5** | Autoâ€‘RefactorÂ (ASTÂ +Â LLM) | ì½”ë“œ ê±´ê°• â–³, ë¶€ì±„Â â†“ |
| **v3.0** | Commit IntelligenceÂ Graph API | ìƒíƒœê³„Â ì—°ë™Â í™•ì¥ |

**Comfort Commit** ì€ ì»¤ë°‹â€‘ì§€ëŠ¥ â†’ ì½”ë“œâ€‘ì§€ëŠ¥ â†’ ì¡°ì§â€‘ì§€ëŠ¥ ìœ¼ë¡œ ì§„í™”í•˜ì—¬  
ê°œë°œìì˜ ê¸°ì–µÂ·ì‹œê°„ì„ ë³´ì¡´í•˜ëŠ” **ê°œë°œê²½í—˜Â OS** ë¡œ ìë¦¬ì¡ëŠ”ë‹¤.
""")

path = pathlib.Path("/mnt/data/ComfortCommit_9-12.md")
path.write_text(md9_12, encoding="utf-8")